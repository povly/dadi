(()=>{"use strict";var t,e,i,n={571058:(t,e,i)=>{i.d(e,{EasterEggs:()=>p});var n=i(11010),o=i(936392),a=i(795558),s=i(664988),r=i(953908),c=i(957973),d=i(193452),l=i(584356),h=i(68003),u=i(321850),g=i(931917);const p={URL:"easter-eggs",ANIMATION_GROUP:"easter_eggs",CLICK_ANIMATION_GROUP:"easter_eggs_click",ACT_POPUP:"getPopup",ACT_FOUND_EGG:"foundEgg",ACT_HIDE_EVENT:"hideEvent",ACT_EASTER_EGGS:"getEasterEggs",ACT_PERFORM_ACTION:"performAction",frames:{},activeAnimations:{},_init:function(t){this.eggs=t,this._checkContainer(),this._setEggs(),this._setCurEvents(),o.LottieManager.observer.ignoreGroup(this.CLICK_ANIMATION_GROUP)},_setCurEvents:function(){this.curSet||(this.curSet=!0,window.cur._back?(window.cur._back.hide&&window.cur._back.hide.push(this._flush.bind(this)),window.cur._back.show&&(window.cur._back.show.push(this._flush.bind(this)),window.cur._back.show.push(this.updateEggs.bind(this)))):(0,u.pushNavDestroy)((()=>this._flush())))},_flush:function(t){if(this.activeAnimations)for(let e in this.activeAnimations)if(this.activeAnimations.hasOwnProperty(e)){const i=e.split("_");(0,s.isNumeric)(t)&&t!==parseInt(i[0])||(this.activeAnimations[e].stop(),this.activeAnimations[e].destroy(),delete this.activeAnimations[e])}if(this.frames)for(let e in this.frames)if(this.frames.hasOwnProperty(e)){const i=e.split("_");(0,s.isNumeric)(t)&&t!==parseInt(i[0])||((0,r.removeEvent)(this.frames[e],"click"),(0,r.removeEvent)((0,a.geByClass)("EasterEggFrame__hideEvent",this.frames[e]),"click"),this.frames[e].parentNode.removeChild(this.frames[e]),delete this.frames[e])}this.container&&(this.container.innerHTML=""),this.frames=[],this.activeAnimations=[]},_checkContainer:function(){this.container||(this.container=document.body.appendChild((0,a.ce)("div",{className:"EasterEggsContainer",innerHTML:""})))},_setEggs:function(){this.eggs&&this.eggs.forEach((t=>{t.positions&&t.positions.length&&t.positions.forEach((e=>{this._validPosition(e.url_regexp)&&this._appendEasterEgg(e,t)}))}))},_validPosition:function(t){if(t=(t||"").replace(/(^#)|(#$)/g,""))try{const e=new RegExp(t),i=this._getNormalizedUrl();return e.test(i)}catch(t){return!1}return!1},_getNormalizedUrl(){switch(window.cur.module){case"profile":return"/id"+(window.cur.oid||0);case"groups":return"/club"+(void 0===window.cur.oid?0:-window.cur.oid);default:return location.pathname}},_appendEasterEgg:function(t,e){var i;if(null==(i=e.animation)?void 0:i.url){var d,l=this;this._getAnimation(null==(d=e.animation)?void 0:d.url).then((0,n._)((function*(i){var n,d,h,u,g;const p=document.createElement("div");p.className="EasterEggFrame",(0,r.addEvent)(p,"click",function i(){(0,r.removeEvent)(p,"click",i),this.onFrameClick({eggId:e.id,eggEventId:e.event_id,positionId:t.position_id,hash:t.hash,url:e.url,clickAnimation:e.click_animation})}.bind(l));const v=document.createElement("div");var m,_;(v.className="EasterEggFrame__hideEvent",(0,r.addEvent)(v,"click",(i=>{(0,r.stopEvent)(i),l.onHideClick({eventId:e.event_id,eggId:e.id,positionId:t.position_id})})),(0,s.isNumeric)(t.appearance.top)?(0,a.setStyle)(p,{top:t.appearance.top}):(0,s.isNumeric)(t.appearance.bottom)&&(0,a.setStyle)(p,{bottom:t.appearance.bottom}),(0,s.isNumeric)(t.appearance.left)?((0,a.setStyle)(p,{left:t.appearance.left}),(0,a.setStyle)(v,{right:0})):(0,s.isNumeric)(t.appearance.right)&&((0,a.setStyle)(p,{right:t.appearance.right}),(0,a.setStyle)(v,{left:0})),t.appearance.fixed&&(0,a.setStyle)(p,{position:"absolute"}),null==(n=e.animation)?void 0:n.width)&&(0,a.setStyle)(p,{width:null==(m=e.animation)?void 0:m.width});(null==(d=e.animation)?void 0:d.height)&&(0,a.setStyle)(p,{height:null==(_=e.animation)?void 0:_.height});let f=null;t.appearance.container&&(f=document.querySelector(t.appearance.container)),f?f.appendChild(p):l.container.appendChild(p),p.style.display="block";const w=yield o.LottieManager.loadAnimation({group:l.ANIMATION_GROUP,name:null==(h=e.animation)?void 0:h.url,animationData:i,containers:[p],width:null==(u=e.animation)?void 0:u.width,height:null==(g=e.animation)?void 0:g.height,loop:!0,autoplay:!0}).catch((()=>{p.style.display="none"}));p.appendChild(v);const E=e.id+"_"+t.position_id;l.frames[E]=p,l.activeAnimations[E]=w,l.sendStats(c.IEasterEggsItemEventType.EGG_SHOW,e.id,e.event_id,t.position_id)})))}},_runClickAnimation(t,e,i,s){return(0,n._)((function*(){var n,r,c,d;const l=t+"_"+e,h=this.frames[l],u=this.activeAnimations[l];var g,p;(null==(n=i)?void 0:n.width)&&(0,a.setStyle)(h,{width:null==(g=i)?void 0:g.width});(null==(r=i)?void 0:r.height)&&(0,a.setStyle)(h,{height:null==(p=i)?void 0:p.height});const v=yield o.LottieManager.loadAnimation({group:this.CLICK_ANIMATION_GROUP,name:i.url,animationData:s,containers:[h],width:null==(c=i)?void 0:c.width,height:null==(d=i)?void 0:d.height,loop:!1,autoplay:!0});u&&u.destroy(),this.activeAnimations[l]=v})).apply(this)},_getAnimation:function(t){return new Promise(((e,i)=>{const n=new XMLHttpRequest;n.open("GET",t,!0),n.send(),n.onreadystatechange=()=>{if(4===n.readyState)try{const t=JSON.parse(n.responseText);e(t)}catch(t){i()}}}))},onFrameClick:function(t){if(!(0,s.isNumeric)(t.eggId)||!(0,s.isNumeric)(t.positionId))return;const e=()=>{this._foundEgg(t.eggId,t.positionId,t.hash,(()=>{if(this._flush(t.eggId),t.url)return window.nav.go(t.url);this._showPopup(t.eggId,t.eggEventId,t.positionId)}))};var i;t.clickAnimation&&t.clickAnimation.url?this._getAnimation(null==(i=t.clickAnimation)?void 0:i.url).then((i=>{var n;this._runClickAnimation(t.eggId,t.positionId,t.clickAnimation,i),setTimeout(e,(null==(n=t.clickAnimation)?void 0:n.duration)||0)})):e()},onHideClick:function(t){window.ajax.post(this.URL,{act:this.ACT_HIDE_EVENT,event_id:t.eventId,egg_id:t.eggId,position_id:t.positionId},{onDone:()=>{this.updateEggs()},onFail:()=>!0})},_foundEgg:function(t,e,i,n){window.ajax.post(this.URL,{act:this.ACT_FOUND_EGG,egg_id:t,position_id:e,position_hash:i},{onDone:()=>{this.updateEggs(),n&&n()},onFail:()=>!0})},updateEggs:function(){this._flush(),window.ajax.post(this.URL,{act:this.ACT_EASTER_EGGS,url:window.location.pathname},{onDone:t=>{t&&this._init(t)},onFail:()=>!0})},_showPopup:function(t,e,i){g.Ranges.isUserId(window.vk.id)&&window.ajax.post(this.URL,{act:this.ACT_POPUP,egg_id:t},{onDone:(n,o,a)=>{if(!o)return;if("function"!=typeof window.MessageBox)return;const s=new window.MessageBox({title:n,hideButtons:!0,needShadow:!1,containerClass:"ImageStatusPopup__container",onShow:()=>{this.sendStats(c.IEasterEggsItemEventType.POPUP_SHOW,t,e,i),this.curBoxData={eggId:t,eggEventId:e,positionId:i}},onDestroy:()=>{this.curBoxData={}}});s.content(o),s.show(),setTimeout((()=>{s.evalBox(a,this.URL,{act:this.ACT_POPUP})}))},onFail:()=>!0})},sendStats:function(t,e=0,i=0,n=0){t===c.IEasterEggsItemEventType.POPUP_ACTION&&this.curBoxData&&(e=this.curBoxData.eggId,i=this.curBoxData.eggEventId,n=this.curBoxData.positionId),d.easterEggsItemStat.logEvent(e,i,n,t)},performAction:function(t,e){e.preventDefault(),this.sendStats(c.IEasterEggsItemEventType.POPUP_ACTION),t&&window.ajax.post(this.URL,{act:this.ACT_PERFORM_ACTION,jwt:t},{onDone:()=>{var t;return null==(t=(0,l.curBox)())||t.hide(),!0},onFail:()=>{var t;return null==(t=(0,l.curBox)())||t.hide(),!0}})},setLightTheme(t){var e;t.preventDefault(),this.sendStats(c.IEasterEggsItemEventType.POPUP_ACTION),null==(e=(0,l.curBox)())||e.hide(),h.colorScheme.setMode(h.ColorSchemeMode.Light)}}},766751:(t,e,i)=>{var n,o,a,s=i(571058);(null==(o=window.vk)||null==(n=o.pe)?void 0:n.static_manager_dynamic_imports)&&(null==(a=window.vk)?void 0:a.stDomain)&&(i.p=window.vk.stDomain+"/dist/"),window.EasterEggs=s.EasterEggs;try{window.stManager.done(window.jsc("web/easter_eggs.js"))}catch(t){}}},o={};function a(t){var e=o[t];if(void 0!==e)return e.exports;var i=o[t]={exports:{}};return n[t].call(i.exports,i,i.exports,a),i.exports}a.m=n,t=[],a.O=(e,i,n,o)=>{if(!i){var s=1/0;for(l=0;l<t.length;l++){for(var[i,n,o]=t[l],r=!0,c=0;c<i.length;c++)(!1&o||s>=o)&&Object.keys(a.O).every((t=>a.O[t](i[c])))?i.splice(c--,1):(r=!1,o<s&&(s=o));if(r){t.splice(l--,1);var d=n();void 0!==d&&(e=d)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[i,n,o]},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},i=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,a.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var o=Object.create(null);a.r(o);var s={};e=e||[null,i({}),i([]),i(i)];for(var r=2&n&&t;"object"==typeof r&&!~e.indexOf(r);r=i(r))Object.getOwnPropertyNames(r).forEach((e=>s[e]=()=>t[e]));return s.default=()=>t,a.d(o,s),o},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.e=()=>Promise.resolve(),a.u=t=>9202===t?"chunks/9202.72ad8960.js":79118===t?"chunks/"+t+".1f93e9b5.js":void 0,a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.p="/dist/",(()=>{a.b=document.baseURI||self.location.href;var t={77265:0};a.O.j=e=>0===t[e];var e=(e,i)=>{var n,o,[s,r,c]=i,d=0;if(s.some((e=>0!==t[e]))){for(n in r)a.o(r,n)&&(a.m[n]=r[n]);if(c)var l=c(a)}for(e&&e(i);d<s.length;d++)o=s[d],a.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return a.O(l)},i=self.webpackChunkvkweb=self.webpackChunkvkweb||[];i.forEach(e.bind(null,0)),i.push=e.bind(null,i.push.bind(i))})();var s=a.O(void 0,[213,95167,15201],(()=>a(766751)));s=a.O(s)})();